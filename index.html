<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeHub | Discover Anime & Manga</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --dark: #0f0c29;
            --darker: #0a081d;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --hover: rgba(255, 255, 255, 0.15);
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 20%);
            z-index: -1;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: rgba(15, 12, 41, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .logo i {
            font-size: 2rem;
        }
        nav ul {
            display: flex;
            list-style: none;
            gap: 15px;
        }
        nav a {
            color: var(--light);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--secondary);
        }
        .user-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .search-container {
            position: relative;
            width: 300px;
        }
        .search-container input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border-radius: 30px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 0.9rem;
        }
        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 25px;
            margin-top: 20px;
        }
        .content-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title i {
            color: var(--secondary);
        }
        .view-all {
            color: var(--secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }
        .card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        .card-content {
            padding: 15px;
        }
        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .card-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.85rem;
        }
        .rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ffd700;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .sidebar-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .sidebar-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar-title i {
            color: var(--secondary);
        }
        .filter-group {
            margin-bottom: 15px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            font-size: 0.9rem;
        }
        .genre-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .genre-tag {
            background: rgba(78, 205, 196, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-tag:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        .genre-tag.active {
            background: var(--secondary);
            color: white;
        }
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
        }
        .favorite-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .favorite-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        .favorite-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .favorite-content {
            padding: 15px;
        }
        .favorite-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .favorite-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.8rem;
        }
        .status-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        .status-watching {
            background: rgba(78, 205, 196, 0.2);
            color: var(--secondary);
        }
        .status-reading {
            background: rgba(78, 205, 196, 0.2);
            color: var(--secondary);
        }
        .status-completed {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        .status-planning {
            background: rgba(241, 196, 15, 0.2);
            color: var(--warning);
        }
        .status-paused {
            background: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
        }
        .status-dropped {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
        }
        .page-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }
        .page-btn:hover, .page-btn.active {
            background: var(--primary);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }
        .modal-content {
            background: rgba(26, 26, 46, 0.95);
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            margin-top: 50px;
        }
        .modal-header {
            position: relative;
            height: 300px;
            overflow: hidden;
        }
        .modal-banner {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(26, 26, 46, 1), transparent 60%);
        }
        .modal-content-inner {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            gap: 20px;
            align-items: flex-end;
        }
        .modal-image {
            flex: 0 0 180px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--border);
        }
        .modal-image img {
            width: 100%;
            display: block;
        }
        .modal-info {
            flex: 1;
            color: white;
        }
        .modal-title {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .modal-native-title {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .modal-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .modal-detail {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .modal-description {
            line-height: 1.6;
            color: #ddd;
            margin-bottom: 20px;
            font-size: 1rem;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .modal-description::-webkit-scrollbar {
            width: 6px;
        }
        .modal-description::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        .modal-description::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 3px;
        }
        .modal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card-modal {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .stat-value-modal {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        .stat-label-modal {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .modal-section {
            padding: 20px;
        }
        .modal-section h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .genres-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .genre-tag-modal {
            background: rgba(78, 205, 196, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.3s;
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
        }
        .close-modal:hover {
            color: var(--primary);
            background: rgba(255, 107, 107, 0.2);
            transform: rotate(90deg);
        }
        .favorite-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .action-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .action-btn:hover {
            background: var(--primary);
        }
        .action-btn.secondary {
            background: rgba(78, 205, 196, 0.2);
        }
        .action-btn.secondary:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        .action-btn.favorite {
            background: rgba(231, 76, 60, 0.2);
        }
        .action-btn.favorite:hover {
            background: rgba(231, 76, 60, 0.4);
        }
        .action-btn.favorite.active {
            background: var(--danger);
        }
        .progress-container {
            margin-top: 15px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--gray);
        }
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        .error {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            border-top: 1px solid var(--border);
            color: var(--gray);
            font-size: 0.9rem;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 2000;
        }
        .notification.show {
            transform: translateX(0);
        }
        /* Profile Styles */
        .profile-dropdown {
            position: relative;
            display: inline-block;
        }
        .profile-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .profile-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .dropdown-content {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            width: 250px;
            padding: 15px;
            z-index: 1000;
            display: none;
        }
        .dropdown-content.show {
            display: block;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .profile-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--secondary);
        }
        .profile-info h3 {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        .profile-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        .profile-links {
            margin: 15px 0;
        }
        .profile-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s;
        }
        .profile-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .stat-card-profile {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .stat-value-profile {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 3px;
        }
        .stat-label-profile {
            font-size: 0.75rem;
            color: var(--gray);
        }
        .profile-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
        }
        .logout-btn {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.4);
        }
        .login-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .login-btn:hover {
            background: #ff5252;
        }
        /* List Section Styles */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .tab-btn.active {
            background: var(--primary);
        }
        .list-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .list-filter-group {
            flex: 1;
            min-width: 200px;
        }
        .list-search-container {
            position: relative;
            flex: 2;
        }
        .list-search-container input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 0.9rem;
        }
        .list-search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        .list-filter-select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 0.9rem;
            cursor: pointer;
        }
        .list-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .list-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        .list-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }
        .list-item-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .list-item-img {
            width: 80px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
        }
        .list-item-info {
            flex: 1;
        }
        .list-item-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .list-item-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray);
        }
        .list-item-type {
            background: rgba(78, 205, 196, 0.2);
            padding: 3px 8px;
            border-radius: 12px;
        }
        .list-item-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .list-item-progress {
            margin-bottom: 15px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: var(--gray);
        }
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }
        .list-item-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .action-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-width: 120px;
        }
        .progress-input, .score-input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            font-size: 0.9rem;
        }
        .status-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            font-size: 0.9rem;
            cursor: pointer;
        }
        .list-item-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .list-item-btn:hover {
            background: var(--danger);
        }
        .list-item-btn.secondary {
            background: rgba(78, 205, 196, 0.2);
        }
        .list-item-btn.secondary:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                grid-row: 1;
            }
            .search-container {
                width: 200px;
            }
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            .search-container {
                width: 100%;
            }
            .modal-content-inner {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .modal-image {
                flex: 0 0 150px;
            }
            .modal-title {
                font-size: 1.5rem;
            }
            .cards-grid, .favorites-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .list-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 480px) {
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .view-all {
                align-self: flex-end;
            }
            .modal-details {
                flex-direction: column;
                gap: 5px;
            }
            .list-filters {
                flex-direction: column;
                align-items: stretch;
            }
            .list-filter-group {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-otaku"></i>
                <span>AnimeHub</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-tab="home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" data-tab="anime"><i class="fas fa-tv"></i> Anime</a></li>
                    <li><a href="#" data-tab="manga"><i class="fas fa-book"></i> Manga</a></li>
                    <li><a href="#" data-tab="seasonal"><i class="fas fa-calendar-alt"></i> Seasons</a></li>
                    <li><a href="#" data-tab="favorites"><i class="fas fa-heart"></i> Favorites</a></li>
                    <li><a href="#" data-tab="lists"><i class="fas fa-list"></i> My Lists</a></li>
                </ul>
            </nav>
            <div class="user-controls">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search anime, manga...">
                </div>
                <div class="profile-dropdown">
                    <button class="profile-button" id="profile-btn">
                        <i class="fas fa-user-circle fa-2x"></i>
                    </button>
                    <div class="dropdown-content" id="dropdown-content">
                        <div class="profile-header">
                            <img src="https://ui-avatars.com/api/?name=User&size=50" alt="User Avatar" class="profile-avatar">
                            <div class="profile-info">
                                <h3 id="user-name">Guest User</h3>
                                <p id="user-since">Not logged in</p>
                            </div>
                        </div>
                        <div class="profile-links">
                            <a href="#" class="profile-link" data-tab="favorites">
                                <i class="fas fa-heart"></i> Favorites
                            </a>
                            <a href="#" class="profile-link" data-tab="lists">
                                <i class="fas fa-list"></i> My Lists
                            </a>
                            <a href="#" class="profile-link">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-anime-count">0</div>
                                <div class="stat-label-profile">Anime Watched</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-manga-count">0</div>
                                <div class="stat-label-profile">Manga Read</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-favorites-count">0</div>
                                <div class="stat-label-profile">Favorites</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-watchlist-count">0</div>
                                <div class="stat-label-profile">Watchlist</div>
                            </div>
                        </div>
                        <div class="profile-footer">
                            <button class="login-btn" id="login-btn">
                                <i class="fab fa-anilist"></i> Login with AniList
                            </button>
                            <button class="logout-btn" id="logout-btn" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div class="main-content">
            <div class="content-section" id="content-area">
                <!-- Content will be loaded here dynamically -->
            </div>
            <div class="sidebar" id="sidebar">
                <div class="sidebar-card" id="sidebar-filters">
                    <h3 class="sidebar-title"><i class="fas fa-filter"></i> Filters</h3>
                    <div class="filter-group">
                        <label for="format">Format</label>
                        <select id="format">
                            <option value="ALL">All Formats</option>
                            <option value="TV">TV</option>
                            <option value="MOVIE">Movie</option>
                            <option value="OVA">OVA</option>
                            <option value="SPECIAL">Special</option>
                            <option value="ONA">ONA</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="year">Year</label>
                        <input type="number" id="year" placeholder="Enter year" min="1950" max="2030">
                    </div>
                    <div class="filter-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="ALL">All Status</option>
                            <option value="FINISHED">Finished</option>
                            <option value="RELEASING">Releasing</option>
                            <option value="NOT_YET_RELEASED">Not Yet Released</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="score">Minimum Score</label>
                        <select id="score">
                            <option value="0">Any Score</option>
                            <option value="70">7+</option>
                            <option value="80">8+</option>
                            <option value="90">9+</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="sort">Sort By</label>
                        <select id="sort">
                            <option value="POPULARITY_DESC">Popularity</option>
                            <option value="SCORE_DESC">Score</option>
                            <option value="TRENDING_DESC">Trending</option>
                            <option value="FAVOURITES_DESC">Favorites</option>
                            <option value="START_DATE_DESC">Newest</option>
                            <option value="TITLE_ROMAJI">Title</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Genres</label>
                        <div class="genre-list" id="genre-tags">
                            <!-- Genre tags will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="sidebar-card">
                    <h3 class="sidebar-title"><i class="fas fa-chart-line"></i> Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="anime-count">0</div>
                            <div class="stat-label">Anime</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="manga-count">0</div>
                            <div class="stat-label">Manga</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="user-count">0</div>
                            <div class="stat-label">Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="review-count">0</div>
                            <div class="stat-label">Reviews</div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-card">
                    <h3 class="sidebar-title"><i class="fas fa-heart"></i> Your Favorites</h3>
                    <div class="favorites-grid" id="favorites-display">
                        <!-- Favorites will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>AnimeHub &copy; 2023 | Powered by AniList API</p>
            <p>This is a fan project and not affiliated with AniList.</p>
        </footer>
    </div>
    <!-- Modal for media details -->
    <div class="modal" id="media-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modal-body">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>
    <!-- Notification -->
    <div class="notification" id="notification">
        Item added to favorites!
    </div>
    <script>
        // Global variables
        let currentTab = 'home';
        let currentPage = 1;
        let totalPages = 1;
        let currentSearchTerm = '';
        let currentUser = null;
        let genres = [];
        let animeList = [];
        let mangaList = [];
        let animeListFromApi = [];
        let mangaListFromApi = [];
        let favoritesList = [];
        // DOM Elements
        const contentArea = document.getElementById('content-area');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('media-modal');
        const modalBody = document.getElementById('modal-body');
        const closeModal = document.querySelector('.close-modal');
        const notification = document.getElementById('notification');
        const genreTagsContainer = document.getElementById('genre-tags');
        const animeCount = document.getElementById('anime-count');
        const mangaCount = document.getElementById('manga-count');
        const userCount = document.getElementById('user-count');
        const reviewCount = document.getElementById('review-count');
        const favoritesDisplay = document.getElementById('favorites-display');
        const profileBtn = document.getElementById('profile-btn');
        const dropdownContent = document.getElementById('dropdown-content');
        const logoutBtn = document.getElementById('logout-btn');
        const loginBtn = document.getElementById('login-btn');
        const userName = document.getElementById('user-name');
        const userSince = document.getElementById('user-since');
        const sidebar = document.getElementById('sidebar');
        const sidebarFilters = document.getElementById('sidebar-filters');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial data
            loadGenres();
            loadStats();
            loadFavoritesDisplay();
            // Set up event listeners
            setupEventListeners();
            // Load home content
            loadHomeContent();
            // Load profile stats
            loadProfileStats();
            // Check if user is already logged in
            checkLoginStatus();
            // Hide filters for home, favorites and lists
            updateSidebarFilters();
        });

        // Update sidebar filters visibility based on current tab
        function updateSidebarFilters() {
            if (['anime', 'manga', 'seasonal'].includes(currentTab)) {
                sidebarFilters.style.display = 'block';
            } else {
                sidebarFilters.style.display = 'none';
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('nav a').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    currentPage = 1; // Reset to first page when switching tabs
                    updateSidebarFilters();
                    loadContent();
                });
            });
            // Search functionality
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    currentSearchTerm = searchInput.value.trim();
                    loadContent();
                }
            });
            // Modal close
            closeModal.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            // Profile dropdown
            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownContent.classList.toggle('show');
            });
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!profileBtn.contains(e.target) && !dropdownContent.contains(e.target)) {
                    dropdownContent.classList.remove('show');
                }
            });
            // Logout
            logoutBtn.addEventListener('click', () => {
                logoutUser();
            });
            // Login
            loginBtn.addEventListener('click', () => {
                loginUser();
            });
            // Profile links
            document.querySelectorAll('.profile-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tab = link.dataset.tab;
                    if (tab) {
                        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                        const tabLink = document.querySelector(`nav a[data-tab="${tab}"]`);
                        if (tabLink) {
                            tabLink.classList.add('active');
                            currentTab = tab;
                            currentPage = 1;
                            updateSidebarFilters();
                            loadContent();
                            dropdownContent.classList.remove('show');
                        }
                    }
                });
            });
            // Filter changes
            document.getElementById('format').addEventListener('change', loadContent);
            document.getElementById('year').addEventListener('change', loadContent);
            document.getElementById('status').addEventListener('change', loadContent);
            document.getElementById('score').addEventListener('change', loadContent);
            document.getElementById('sort').addEventListener('change', loadContent);
            // Genre tag clicks
            genreTagsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('genre-tag')) {
                    e.target.classList.toggle('active');
                    loadContent();
                }
            });
        }

        // Check login status
        function checkLoginStatus() {
            const token = localStorage.getItem('anilist_token');
            if (token) {
                // User is logged in
                fetchUserData(token);
            } else {
                // User is not logged in
                updateUserUI(false);
            }
        }

        // Login user function
        function loginUser() {
            const clientId = '29049'; // Your actual Client ID from AniList
            const redirectUri = encodeURIComponent('https://streamall-phi.vercel.app/'); // Exact match with AniList settings
            const authUrl = `https://anilist.co/api/v2/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code`;
            console.log('Redirecting to:', authUrl); // Debug line
            window.location.href = authUrl;
        }

        // Handle OAuth callback
        function handleOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                // Exchange code for token
                exchangeCodeForToken(code);
            }
        }

        // Exchange authorization code for access token
        async function exchangeCodeForToken(code) {
            try {
                const response = await fetch('/api/exchange-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code
                    })
                });
                const data = await response.json();
                if (data.access_token) {
                    localStorage.setItem('anilist_token', data.access_token);
                    fetchUserData(data.access_token);
                    // Clean URL without code parameter
                    window.history.pushState({}, document.title, window.location.pathname);
                    return true;
                } else {
                    console.error('Failed to get access token:', data);
                    return false;
                }
            } catch (error) {
                console.error('Error in exchangeCodeForToken:', error);
                return false;
            }
        }

        // Fetch user data including lists
        async function fetchUserData(token) {
            try {
                // First get the user ID
                const viewerResponse = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                Viewer {
                                    id
                                    name
                                    avatar {
                                        large
                                    }
                                    bannerImage
                                    about
                                    statistics {
                                        anime {
                                            count
                                            episodesWatched
                                            meanScore
                                        }
                                        manga {
                                            count
                                            chaptersRead
                                            meanScore
                                        }
                                    }
                                    mediaListOptions {
                                        scoreFormat
                                        animeList {
                                            sectionOrder
                                        }
                                        mangaList {
                                            sectionOrder
                                        }
                                    }
                                }
                            }
                        `
                    })
                });
                const viewerData = await viewerResponse.json();
                if (viewerData.errors || !viewerData.data?.Viewer) {
                    console.error('Failed to fetch user data:', viewerData.errors);
                    showNotification('Failed to fetch user data');
                    return false;
                }
                currentUser = viewerData.data.Viewer;
                updateUserUI(true);
                showNotification('Successfully logged in!');
                
                // Fetch lists from API
                await fetchUserLists(token);
                
                return true;
            } catch (error) {
                console.error('Error fetching user data:', error);
                showNotification('Network error fetching user data');
                return false;
            }
        }

        // Fetch user lists from API
        async function fetchUserLists(token) {
            try {
                // Fetch anime list
                const animeResponse = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query ($userId: Int) {
                                animeList: MediaListCollection(userId: $userId, type: ANIME) {
                                    lists {
                                        name
                                        entries {
                                            id
                                            media {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                                episodes
                                            }
                                            status
                                            progress
                                            score
                                        }
                                    }
                                }
                            }
                        `,
                        variables: {
                            userId: currentUser.id
                        }
                    })
                });
                const animeData = await animeResponse.json();
                if (animeData.data?.animeList) {
                    animeListFromApi = animeData.data.animeList.lists.flatMap(list => list.entries);
                    animeList = animeListFromApi.map(entry => ({
                        id: entry.media.id,
                        title: entry.media.title.english || entry.media.title.romaji || 'Untitled',
                        image: entry.media.coverImage.large,
                        type: 'anime',
                        status: entry.status.toLowerCase(),
                        score: entry.score,
                        progress: entry.progress,
                        maxProgress: entry.media.episodes || 0
                    }));
                }
                
                // Fetch manga list
                const mangaResponse = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query ($userId: Int) {
                                mangaList: MediaListCollection(userId: $userId, type: MANGA) {
                                    lists {
                                        name
                                        entries {
                                            id
                                            media {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                                chapters
                                            }
                                            status
                                            progress
                                            score
                                        }
                                    }
                                }
                            }
                        `,
                        variables: {
                            userId: currentUser.id
                        }
                    })
                });
                const mangaData = await mangaResponse.json();
                if (mangaData.data?.mangaList) {
                    mangaListFromApi = mangaData.data.mangaList.lists.flatMap(list => list.entries);
                    mangaList = mangaListFromApi.map(entry => ({
                        id: entry.media.id,
                        title: entry.media.title.english || entry.media.title.romaji || 'Untitled',
                        image: entry.media.coverImage.large,
                        type: 'manga',
                        status: entry.status.toLowerCase(),
                        score: entry.score,
                        progress: entry.progress,
                        maxProgress: entry.media.chapters || 0
                    }));
                }
                
                // Fetch favorites
                const favoritesResponse = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query ($userId: Int) {
                                User(id: $userId) {
                                    favourites {
                                        anime {
                                            nodes {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                            }
                                        }
                                        manga {
                                            nodes {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        `,
                        variables: {
                            userId: currentUser.id
                        }
                    })
                });
                const favoritesData = await favoritesResponse.json();
                if (favoritesData.data?.User?.favourites) {
                    favoritesList = [
                        ...favoritesData.data.User.favourites.anime.nodes.map(media => ({
                            id: media.id,
                            title: media.title.english || media.title.romaji || 'Untitled',
                            image: media.coverImage.large,
                            type: 'anime'
                        })),
                        ...favoritesData.data.User.favourites.manga.nodes.map(media => ({
                            id: media.id,
                            title: media.title.english || media.title.romaji || 'Untitled',
                            image: media.coverImage.large,
                            type: 'manga'
                        }))
                    ];
                }
                
                // Update UI with fetched data
                loadProfileStats();
                loadFavoritesDisplay();
                loadListContent();
            } catch (error) {
                console.error('Error fetching user lists:', error);
                showNotification('Failed to load user lists');
            }
        }

        // Update UI based on login status
        function updateUserUI(isLoggedIn) {
            if (isLoggedIn && currentUser) {
                // Update with available fields
                userName.textContent = currentUser.name;
                userSince.textContent = `Member since ${new Date().getFullYear()}`;
                // Update avatar if available
                if (currentUser.avatar) {
                    // Update profile picture in UI
                }
                // Update stats
                if (currentUser.statistics) {
                    document.getElementById('profile-anime-count').textContent = 
                        currentUser.statistics.anime?.count || 0;
                    document.getElementById('profile-manga-count').textContent = 
                        currentUser.statistics.manga?.count || 0;
                }
                // Show/hide appropriate buttons
                logoutBtn.style.display = 'block';
                loginBtn.style.display = 'none';
            } else {
                // Guest user state
                userName.textContent = 'Guest User';
                userSince.textContent = 'Not logged in';
                logoutBtn.style.display = 'none';
                loginBtn.style.display = 'block';
            }
        }

        // Logout user
        function logoutUser() {
            localStorage.removeItem('anilist_token');
            currentUser = null;
            updateUserUI(false);
            showNotification('Logged out successfully');
        }

        // Load genres from API
        async function loadGenres() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                GenreCollection
                            }
                        `
                    })
                });
                const data = await response.json();
                if (data.data && data.data.GenreCollection) {
                    genres = data.data.GenreCollection;
                    renderGenreTags();
                }
            } catch (error) {
                console.error('Error loading genres:', error);
            }
        }

        // Render genre tags
        function renderGenreTags() {
            genreTagsContainer.innerHTML = '';
            genres.forEach(genre => {
                const tag = document.createElement('div');
                tag.className = 'genre-tag';
                tag.textContent = genre;
                tag.dataset.genre = genre;
                genreTagsContainer.appendChild(tag);
            });
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                anime: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                manga: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                user: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                review: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                            }
                        `
                    })
                });
                const data = await response.json();
                // Defensive checks
                if (data.data) {
                    animeCount.textContent = data.data.anime?.pageInfo?.total?.toLocaleString() || '0';
                    mangaCount.textContent = data.data.manga?.pageInfo?.total?.toLocaleString() || '0';
                    userCount.textContent = data.data.user?.pageInfo?.total?.toLocaleString() || '0';
                    reviewCount.textContent = data.data.review?.pageInfo?.total?.toLocaleString() || '0';
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                // Set default values
                animeCount.textContent = '0';
                mangaCount.textContent = '0';
                userCount.textContent = '0';
                reviewCount.textContent = '0';
            }
        }

        // Load favorites display
        function loadFavoritesDisplay() {
            if (favoritesList.length === 0) {
                favoritesDisplay.innerHTML = '<div class="empty-state"><i class="fas fa-heart"></i><p>No favorites yet</p></div>';
                return;
            }
            
            favoritesDisplay.innerHTML = favoritesList.slice(0, 4).map(favorite => `
                <div class="favorite-card" data-id="${favorite.id}">
                    <img src="${favorite.image}" alt="${favorite.title}" class="favorite-img">
                    <div class="favorite-content">
                        <h3 class="favorite-title">${favorite.title}</h3>
                        <div class="favorite-meta">
                            <span class="status-badge status-${favorite.type === 'anime' ? 'watching' : 'reading'}">
                                ${favorite.type === 'anime' ? 'Anime' : 'Manga'}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add click events to favorite cards
            document.querySelectorAll('.favorite-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    openMediaDetails(id);
                });
            });
        }

        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'watching': 'Watching',
                'reading': 'Reading',
                'completed': 'Completed',
                'planning': 'Planning',
                'paused': 'Paused',
                'dropped': 'Dropped'
            };
            return statusMap[status] || status;
        }

        // Load content based on current tab
        function loadContent() {
            switch(currentTab) {
                case 'home':
                    loadHomeContent();
                    break;
                case 'anime':
                    loadAnimeContent();
                    break;
                case 'manga':
                    loadMangaContent();
                    break;
                case 'seasonal':
                    loadSeasonalContent();
                    break;
                case 'favorites':
                    loadFavoritesContent();
                    break;
                case 'lists':
                    loadListsContent();
                    break;
                case 'recent':
                    loadRecentContent();
                    break;
                case 'top':
                    loadTopContent();
                    break;
                case 'upcoming':
                    loadUpcomingContent();
                    break;
                default:
                    loadHomeContent();
            }
        }

        // Load home content
        function loadHomeContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-fire"></i> Trending Now</h2>
                    <a href="#" class="view-all" data-tab="anime">View All</a>
                </div>
                <div class="cards-grid" id="trending-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading trending content...</p>
                    </div>
                </div>
                <div class="section-header" style="margin-top: 30px;">
                    <h2 class="section-title"><i class="fas fa-star"></i> Top Rated</h2>
                    <a href="#" class="view-all" data-tab="anime">View All</a>
                </div>
                <div class="cards-grid" id="top-rated-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading top rated content...</p>
                    </div>
                </div>
            `;
            // Load trending and top rated content
            loadTrendingContent();
            loadTopRatedContent();
        }

        // Load trending content
        async function loadTrendingContent() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: TRENDING_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 8
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'trending-grid');
                }
            } catch (error) {
                document.getElementById('trending-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading trending content</p>
                    </div>
                `;
                console.error('Error loading trending content:', error);
            }
        }

        // Load top rated content
        async function loadTopRatedContent() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: SCORE_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 8
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'top-rated-grid');
                }
            } catch (error) {
                document.getElementById('top-rated-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading top rated content</p>
                    </div>
                `;
                console.error('Error loading top rated content:', error);
            }
        }

        // Load anime content
        function loadAnimeContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-tv"></i> Anime</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="anime-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading anime content...</p>
                    </div>
                </div>
                <div class="pagination" id="anime-pagination">
                    <!-- Pagination will be added here -->
                </div>
            `;
            loadAnimePage(1);
        }

        // Load anime page
        async function loadAnimePage(page) {
            try {
                const format = document.getElementById('format').value;
                const year = document.getElementById('year').value;
                const status = document.getElementById('status').value;
                const score = document.getElementById('score').value;
                const sort = document.getElementById('sort').value;
                const selectedGenres = Array.from(document.querySelectorAll('.genre-tag.active'))
                    .map(tag => tag.dataset.genre);
                // Build query variables
                const variables = {
                    page: page,
                    perPage: 24,
                    type: 'ANIME',
                    sort: sort
                };
                if (format !== 'ALL') variables.format = format;
                if (year) variables.seasonYear = parseInt(year);
                if (status !== 'ALL') variables.status = status;
                if (score > 0) variables.averageScore_greater = parseInt(score);
                if (selectedGenres.length > 0) variables.genre_in = selectedGenres;
                if (currentSearchTerm) variables.search = currentSearchTerm;
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int, $type: MediaType, $search: String, $format: MediaFormat, $seasonYear: Int, $status: MediaStatus, $genre_in: [String], $averageScore_greater: Int, $sort: [MediaSort]) {
                                Page(page: $page, perPage: $perPage) {
                                    pageInfo {
                                        total
                                        currentPage
                                        lastPage
                                        hasNextPage
                                    }
                                    media(
                                        type: $type
                                        search: $search
                                        format: $format
                                        seasonYear: $seasonYear
                                        status: $status
                                        genre_in: $genre_in
                                        averageScore_greater: $averageScore_greater
                                        sort: $sort
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                        format
                                    }
                                }
                            }
                        `,
                        variables: variables
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'anime-grid');
                    renderPagination(data.data.Page.pageInfo, 'anime');
                }
            } catch (error) {
                document.getElementById('anime-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading anime content</p>
                    </div>
                `;
                console.error('Error loading anime content:', error);
            }
        }

        // Load manga content
        function loadMangaContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-book"></i> Manga</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="manga-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading manga content...</p>
                    </div>
                </div>
                <div class="pagination" id="manga-pagination">
                    <!-- Pagination will be added here -->
                </div>
            `;
            loadMangaPage(1);
        }

        // Load manga page
        async function loadMangaPage(page) {
            try {
                const format = document.getElementById('format').value;
                const year = document.getElementById('year').value;
                const status = document.getElementById('status').value;
                const score = document.getElementById('score').value;
                const sort = document.getElementById('sort').value;
                const selectedGenres = Array.from(document.querySelectorAll('.genre-tag.active'))
                    .map(tag => tag.dataset.genre);
                // Build query variables
                const variables = {
                    page: page,
                    perPage: 24,
                    type: 'MANGA',
                    sort: sort
                };
                if (format !== 'ALL') variables.format = format;
                if (year) variables.seasonYear = parseInt(year);
                if (status !== 'ALL') variables.status = status;
                if (score > 0) variables.averageScore_greater = parseInt(score);
                if (selectedGenres.length > 0) variables.genre_in = selectedGenres;
                if (currentSearchTerm) variables.search = currentSearchTerm;
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int, $type: MediaType, $search: String, $format: MediaFormat, $seasonYear: Int, $status: MediaStatus, $genre_in: [String], $averageScore_greater: Int, $sort: [MediaSort]) {
                                Page(page: $page, perPage: $perPage) {
                                    pageInfo {
                                        total
                                        currentPage
                                        lastPage
                                        hasNextPage
                                    }
                                    media(
                                        type: $type
                                        search: $search
                                        format: $format
                                        seasonYear: $seasonYear
                                        status: $status
                                        genre_in: $genre_in
                                        averageScore_greater: $averageScore_greater
                                        sort: $sort
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        chapters
                                        seasonYear
                                        format
                                    }
                                }
                            }
                        `,
                        variables: variables
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'manga-grid');
                    renderPagination(data.data.Page.pageInfo, 'manga');
                }
            } catch (error) {
                document.getElementById('manga-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading manga content</p>
                    </div>
                `;
                console.error('Error loading manga content:', error);
            }
        }

        // Load seasonal content
        function loadSeasonalContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Seasonal Anime</h2>
                    <div class="season-info" id="season-info"></div>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="seasonal-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading seasonal content...</p>
                    </div>
                </div>
            `;
            loadSeasonalPage();
        }

        // Load seasonal page with debugging
        async function loadSeasonalPage() {
            try {
                const now = new Date();
                const currentMonth = now.getMonth();
                let season, year;
                
                // Determine current season and year
                if (currentMonth >= 2 && currentMonth <= 4) {  // March-May
                    season = 'SPRING';
                    year = now.getFullYear();
                } else if (currentMonth >= 5 && currentMonth <= 7) {  // June-August
                    season = 'SUMMER';
                    year = now.getFullYear();
                } else if (currentMonth >= 8 && currentMonth <= 10) {  // September-November
                    season = 'FALL';
                    year = now.getFullYear();
                } else {  // December-February
                    season = 'WINTER';
                    year = (currentMonth === 0 || currentMonth === 1) ? now.getFullYear() : now.getFullYear() + 1;
                }

                // Display season info for debugging
                document.getElementById('season-info').textContent = `Showing ${season} ${year}`;

                // Get filters
                const format = document.getElementById('format').value;
                const status = document.getElementById('status').value;
                const score = document.getElementById('score').value;
                const selectedGenres = Array.from(document.querySelectorAll('.genre-tag.active'))
                    .map(tag => tag.dataset.genre);

                // Prepare query variables
                const variables = {
                    season: season,
                    seasonYear: year,
                    type: 'ANIME',
                    sort: 'POPULARITY_DESC',
                    page: 1,
                    perPage: 24
                };

                // Add optional filters
                if (format !== 'ALL') variables.format = format;
                if (status !== 'ALL') variables.status = status;
                if (score > 0) variables.averageScore_greater = parseInt(score);
                if (selectedGenres.length > 0) variables.genre_in = selectedGenres;

                console.log('Seasonal query variables:', variables);

                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query (
                                $season: MediaSeason,
                                $seasonYear: Int,
                                $type: MediaType,
                                $format: MediaFormat,
                                $status: MediaStatus,
                                $genre_in: [String],
                                $averageScore_greater: Int,
                                $page: Int,
                                $perPage: Int,
                                $sort: [MediaSort]
                            ) {
                                Page(page: $page, perPage: $perPage) {
                                    media(
                                        season: $season
                                        seasonYear: $seasonYear
                                        type: $type
                                        format: $format
                                        status: $status
                                        genre_in: $genre_in
                                        averageScore_greater: $averageScore_greater
                                        sort: $sort
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                        format
                                        status
                                    }
                                }
                            }
                        `,
                        variables: variables
                    })
                });
                
                const data = await response.json();
                console.log('Seasonal API response:', data);

                if (data.data && data.data.Page && data.data.Page.media && data.data.Page.media.length > 0) {
                    renderCards(data.data.Page.media, 'seasonal-grid');
                } else {
                    document.getElementById('seasonal-grid').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <p>No seasonal content found for ${season} ${year}</p>
                            <p>Try adjusting your filters or check back later!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading seasonal content:', error);
                document.getElementById('seasonal-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading seasonal content</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Load recent content
        function loadRecentContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-history"></i> Recently Added</h2>
                </div>
                <div class="cards-grid" id="recent-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading recently added content...</p>
                    </div>
                </div>
            `;
            loadRecentMedia();
        }

        // Load recent media
        async function loadRecentMedia() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: ID_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 12
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'recent-grid');
                }
            } catch (error) {
                document.getElementById('recent-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading recent content</p>
                    </div>
                `;
                console.error('Error loading recent content:', error);
            }
        }

        // Load top content
        function loadTopContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-star"></i> Top Rated</h2>
                </div>
                <div class="cards-grid" id="top-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading top rated content...</p>
                    </div>
                </div>
            `;
            loadTopMedia();
        }

        // Load top media
        async function loadTopMedia() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: SCORE_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 12
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'top-grid');
                }
            } catch (error) {
                document.getElementById('top-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading top content</p>
                    </div>
                `;
                console.error('Error loading top content:', error);
            }
        }

        // Load upcoming content
        function loadUpcomingContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-calendar"></i> Upcoming</h2>
                </div>
                <div class="cards-grid" id="upcoming-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading upcoming content...</p>
                    </div>
                </div>
            `;
            loadUpcomingMedia();
        }

        // Load upcoming media
        async function loadUpcomingMedia() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: START_DATE_DESC, type: ANIME, status: NOT_YET_RELEASED) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 12
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'upcoming-grid');
                }
            } catch (error) {
                document.getElementById('upcoming-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading upcoming content</p>
                    </div>
                `;
                console.error('Error loading upcoming content:', error);
            }
        }

        // Load favorites content
        function loadFavoritesContent() {
            if (!currentUser) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-lock"></i>
                        <p>Please login to view your favorites</p>
                        <button class="login-btn" id="login-btn-favorites" style="margin-top: 20px;">
                            <i class="fab fa-anilist"></i> Login with AniList
                        </button>
                    </div>
                `;
                document.getElementById('login-btn-favorites').addEventListener('click', loginUser);
                return;
            }

            if (favoritesList.length === 0) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>No favorites yet</p>
                    </div>
                `;
                return;
            }

            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-heart"></i> My Favorites</h2>
                </div>
                <div class="cards-grid" id="favorites-grid">
                    ${favoritesList.map(favorite => `
                        <div class="card" data-id="${favorite.id}">
                            <img src="${favorite.image}" alt="${favorite.title}" class="card-img">
                            <div class="card-content">
                                <h3 class="card-title">${favorite.title}</h3>
                                <div class="card-meta">
                                    <span>${favorite.type === 'anime' ? 'Anime' : 'Manga'}</span>
                                    <span class="rating"><i class="fas fa-heart"></i></span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Add click events to favorite cards
            document.querySelectorAll('#favorites-grid .card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    openMediaDetails(id);
                });
            });
        }

        // Load lists content
        function loadListsContent() {
            if (!currentUser) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-lock"></i>
                        <p>Please login to view your lists</p>
                        <button class="login-btn" id="login-btn-lists" style="margin-top: 20px;">
                            <i class="fab fa-anilist"></i> Login with AniList
                        </button>
                    </div>
                `;
                document.getElementById('login-btn-lists').addEventListener('click', loginUser);
                return;
            }

            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-list"></i> My Lists</h2>
                </div>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="anime">Anime List</button>
                    <button class="tab-btn" data-tab="manga">Manga List</button>
                </div>
                <div class="list-filters">
                    <div class="list-filter-group list-search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="list-search" placeholder="Search...">
                    </div>
                    <div class="list-filter-group">
                        <select id="list-status-filter" class="list-filter-select">
                            <option value="all">All Statuses</option>
                            <option value="planning">Planning</option>
                            <option value="watching" class="anime-only">Watching</option>
                            <option value="reading" class="manga-only">Reading</option>
                            <option value="completed">Completed</option>
                            <option value="paused">Paused</option>
                            <option value="dropped">Dropped</option>
                        </select>
                    </div>
                </div>
                <div id="list-content">
                    <!-- List content will be loaded here -->
                </div>
                <div class="pagination" id="list-pagination">
                    <!-- Pagination will be added here -->
                </div>
            `;
            
            // Update status filter options based on active tab
            updateStatusFilterOptions();
            
            // Set up list filters
            document.getElementById('list-search').addEventListener('input', () => {
                loadListContent();
            });
            document.getElementById('list-status-filter').addEventListener('change', () => {
                loadListContent();
            });
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPage = 1; // Reset to first page when switching tabs
                    updateStatusFilterOptions();
                    loadListContent();
                });
            });
            // Load initial list content
            loadListContent();
        }

        // Update status filter options based on active tab
        function updateStatusFilterOptions() {
            const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab || 'anime';
            const statusFilter = document.getElementById('list-status-filter');
            
            // Show/hide appropriate options
            const watchingOption = statusFilter.querySelector('.anime-only');
            const readingOption = statusFilter.querySelector('.manga-only');
            
            if (activeTab === 'anime') {
                watchingOption.style.display = 'block';
                readingOption.style.display = 'none';
            } else {
                watchingOption.style.display = 'none';
                readingOption.style.display = 'block';
            }
        }

        // Load list content
        function loadListContent() {
            const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab || 'anime';
            const searchTerm = document.getElementById('list-search')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('list-status-filter')?.value || 'all';
            
            // Use correct list based on tab
            const listItems = activeTab === 'anime' ? animeList : mangaList;
            
            // Apply filters
            let filteredItems = listItems.filter(item => {
                const matchesSearch = item.title.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || item.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            // Pagination logic
            const itemsPerPage = 12;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = filteredItems.slice(startIndex, endIndex);
            totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            
            // Render list items
            const listContent = document.getElementById('list-content');
            if (listContent) {
                if (paginatedItems.length === 0) {
                    listContent.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-list"></i>
                            <p>No items in your ${activeTab} list</p>
                        </div>
                    `;
                    return;
                }
                
                // Create responsive grid layout
                listContent.innerHTML = `
                    <div class="list-grid">
                        ${paginatedItems.map(item => `
                            <div class="list-item" data-id="${item.id}">
                                <div class="list-item-header">
                                    <img src="${item.image}" alt="${item.title}" class="list-item-img">
                                    <div class="list-item-info">
                                        <h3 class="list-item-title">${item.title}</h3>
                                        <div class="list-item-meta">
                                            <span class="list-item-type">${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</span>
                                            <span class="list-item-status">
                                                <i class="fas fa-${item.type === 'anime' ? 'tv' : 'book'}"></i>
                                                ${getStatusText(item.status)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-item-progress">
                                    <div class="progress-label">
                                        <span>Progress</span>
                                        <span>${item.progress}/${item.maxProgress || '?'}</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${(item.progress / (item.maxProgress || 1)) * 100}%"></div>
                                    </div>
                                </div>
                                <div class="list-item-actions">
                                    <div class="action-group">
                                        <input type="number" class="progress-input" min="0" max="${item.maxProgress}" value="${item.progress}" 
                                               onchange="updateProgress(${item.id}, '${activeTab}', this)" placeholder="Progress">
                                        <input type="number" class="score-input" min="0" max="10" step="0.1" value="${item.score}" 
                                               onchange="updateScore(${item.id}, '${activeTab}', this)" placeholder="Score">
                                    </div>
                                    <div class="action-group">
                                        <select class="status-select" onchange="updateStatus(${item.id}, '${activeTab}', this.value)">
                                            <option value="planning" ${item.status === 'planning' ? 'selected' : ''}>Planning</option>
                                            <option value="${activeTab === 'anime' ? 'watching' : 'reading'}" ${item.status === (activeTab === 'anime' ? 'watching' : 'reading') ? 'selected' : ''}>
                                                ${activeTab === 'anime' ? 'Watching' : 'Reading'}
                                            </option>
                                            <option value="completed" ${item.status === 'completed' ? 'selected' : ''}>Completed</option>
                                            <option value="paused" ${item.status === 'paused' ? 'selected' : ''}>Paused</option>
                                            <option value="dropped" ${item.status === 'dropped' ? 'selected' : ''}>Dropped</option>
                                        </select>
                                        <button class="list-item-btn" onclick="removeFromList(${item.id}, '${activeTab}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Render pagination
            renderListPagination();
        }

        // Render list pagination
        function renderListPagination() {
            const paginationContainer = document.getElementById('list-pagination');
            if (!paginationContainer) return;
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // First page button
            paginationHTML += `
                <button class="page-btn ${currentPage === 1 ? 'active' : ''}" 
                        onclick="changeListPage(1)" ${currentPage === 1 ? 'disabled' : ''}>
                    First
                </button>
            `;
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button class="page-btn" onclick="changeListPage(${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i> Prev
                    </button>
                `;
            }
            
            // Page numbers (limited to show nearby pages)
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                            onclick="changeListPage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button class="page-btn" onclick="changeListPage(${currentPage + 1})">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            // Last page button
            paginationHTML += `
                <button class="page-btn ${currentPage === totalPages ? 'active' : ''}" 
                        onclick="changeListPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>
                    Last
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        // Change list page
        function changeListPage(page) {
            currentPage = page;
            loadListContent();
        }

        // Update progress
        async function updateProgress(id, type, element) {
            const value = parseInt(element.value);
            if (isNaN(value)) return;
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                // Ensure progress doesn't exceed maxProgress
                if (item.maxProgress && value > item.maxProgress) {
                    element.value = item.maxProgress;
                    return;
                }
                item.progress = value;
                
                // Update progress on AniList
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $progress: Int, $type: MediaType) {
                                    SaveMediaListEntry(mediaId: $mediaId, progress: $progress, type: $type) {
                                        id
                                        progress
                                    }
                                }
                            `,
                            variables: {
                                mediaId: id,
                                progress: value,
                                type: type.toUpperCase()
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error updating progress:', data.errors);
                        showNotification('Failed to update progress');
                    } else {
                        showNotification(`Updated ${type} progress`);
                    }
                } catch (error) {
                    console.error('Error updating progress:', error);
                    showNotification('Network error updating progress');
                }
            }
        }

        // Update score
        async function updateScore(id, type, element) {
            const value = parseFloat(element.value);
            if (isNaN(value)) return;
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                item.score = value;
                
                // Update score on AniList
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $score: Float, $type: MediaType) {
                                    SaveMediaListEntry(mediaId: $mediaId, score: $score, type: $type) {
                                        id
                                        score
                                    }
                                }
                            `,
                            variables: {
                                mediaId: id,
                                score: value,
                                type: type.toUpperCase()
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error updating score:', data.errors);
                        showNotification('Failed to update score');
                    } else {
                        showNotification(`Updated ${type} score`);
                    }
                } catch (error) {
                    console.error('Error updating score:', error);
                    showNotification('Network error updating score');
                }
            }
        }

        // Update status
        async function updateStatus(id, type, newStatus) {
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                item.status = newStatus;
                
                // Update status on AniList
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $status: MediaListStatus, $type: MediaType) {
                                    SaveMediaListEntry(mediaId: $mediaId, status: $status, type: $type) {
                                        id
                                        status
                                    }
                                }
                            `,
                            variables: {
                                mediaId: id,
                                status: newStatus.toUpperCase(),
                                type: type.toUpperCase()
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error updating status:', data.errors);
                        showNotification('Failed to update status');
                    } else {
                        showNotification(`Updated status to ${newStatus}`);
                    }
                } catch (error) {
                    console.error('Error updating status:', error);
                    showNotification('Network error updating status');
                }
            }
        }

        // Remove from list
        async function removeFromList(id, type) {
            if (confirm('Are you sure you want to remove this item from your list?')) {
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $type: MediaType) {
                                    DeleteMediaListEntry(mediaId: $mediaId, type: $type) {
                                        deleted
                                    }
                                }
                            `,
                            variables: {
                                mediaId: id,
                                type: type.toUpperCase()
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error removing from list:', data.errors);
                        showNotification('Failed to remove from list');
                    } else {
                        if (type === 'anime') {
                            animeList = animeList.filter(item => item.id !== id);
                        } else {
                            mangaList = mangaList.filter(item => item.id !== id);
                        }
                        loadListContent();
                        showNotification(`${type === 'anime' ? 'Anime' : 'Manga'} removed from list`);
                    }
                } catch (error) {
                    console.error('Error removing from list:', error);
                    showNotification('Network error removing from list');
                }
            }
        }

        // Render cards
        function renderCards(mediaList, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            if (!mediaList || mediaList.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>No results found</p></div>';
                return;
            }
            container.innerHTML = mediaList.map(media => {
                const title = media.title.english || media.title.romaji || 'Untitled';
                const score = media.averageScore ? (media.averageScore / 10).toFixed(1) : 'N/A';
                const year = media.seasonYear || 'Unknown';
                const episodes = media.episodes || media.chapters || '?';
                const type = media.type || 'ANIME';
                return `
                    <div class="card" data-id="${media.id}">
                        <img src="${media.coverImage.large}" alt="${title}" class="card-img">
                        <div class="card-content">
                            <h3 class="card-title">${title}</h3>
                            <div class="card-meta">
                                <span>${year}</span>
                                <span class="rating"><i class="fas fa-star"></i> ${score}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            // Add click events to cards
            document.querySelectorAll(`#${containerId} .card`).forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    openMediaDetails(id);
                });
            });
        }

        // Render pagination
        function renderPagination(pageInfo, type) {
            const paginationContainer = document.getElementById(`${type}-pagination`);
            if (!paginationContainer) return;
            if (pageInfo.lastPage <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            let paginationHTML = '';
            // Previous button
            if (pageInfo.currentPage > 1) {
                paginationHTML += `
                    <button class="page-btn" onclick="changePage('${type}', ${pageInfo.currentPage - 1})">
                        <i class="fas fa-chevron-left"></i> Prev
                    </button>
                `;
            }
            // Page numbers
            const startPage = Math.max(1, pageInfo.currentPage - 2);
            const endPage = Math.min(pageInfo.lastPage, pageInfo.currentPage + 2);
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="page-btn ${i === pageInfo.currentPage ? 'active' : ''}" 
                            onclick="changePage('${type}', ${i})">
                        ${i}
                    </button>
                `;
            }
            // Next button
            if (pageInfo.hasNextPage) {
                paginationHTML += `
                    <button class="page-btn" onclick="changePage('${type}', ${pageInfo.currentPage + 1})">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            paginationContainer.innerHTML = paginationHTML;
        }

        // Change page
        function changePage(type, page) {
            currentPage = page;
            if (type === 'anime') {
                loadAnimePage(page);
            } else if (type === 'manga') {
                loadMangaPage(page);
            }
        }

        // Open media details modal
        async function openMediaDetails(id) {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($id: Int) {
                                Media(id: $id) {
                                    id
                                    title {
                                        romaji
                                        english
                                        native
                                    }
                                    coverImage {
                                        large
                                        extraLarge
                                        color
                                    }
                                    bannerImage
                                    description(asHtml: false)
                                    genres
                                    averageScore
                                    meanScore
                                    popularity
                                    favourites
                                    status
                                    format
                                    startDate {
                                        year
                                        month
                                        day
                                    }
                                    endDate {
                                        year
                                        month
                                        day
                                    }
                                    episodes
                                    chapters
                                    volumes
                                    season
                                    seasonYear
                                    studios {
                                        nodes {
                                            name
                                        }
                                    }
                                    characters(sort: [ROLE, FAVOURITES_DESC], perPage: 6) {
                                        nodes {
                                            name {
                                                full
                                            }
                                            image {
                                                medium
                                            }
                                        }
                                    }
                                }
                            }
                        `,
                        variables: { id: id }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Media) {
                    displayMediaDetails(data.data.Media);
                    modal.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching media details:', error);
                modalBody.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading details</p>
                    </div>
                `;
            }
        }

        function displayMediaDetails(media) {
            const title = media.title.english || media.title.romaji || 'Untitled';
            const nativeTitle = media.title.native || '';
            const description = media.description ? media.description.replace(/<[^>]*>/g, '').substring(0, 500) + '...' : 'No description available.';
            const genres = media.genres ? media.genres.join(', ') : 'N/A';
            const score = media.averageScore ? (media.averageScore / 10).toFixed(1) : 'N/A';
            const meanScore = media.meanScore ? (media.meanScore / 10).toFixed(1) : 'N/A';
            const startDate = media.startDate && media.startDate.year ? 
                `${media.startDate.year}-${media.startDate.month || '??'}-${media.startDate.day || '??'}` : 'Unknown';
            const endDate = media.endDate && media.endDate.year ? 
                `${media.endDate.year}-${media.endDate.month || '??'}-${media.endDate.day || '??'}` : 'Unknown';
            
            // Check if media is in user's lists
            const isInAnimeList = animeList.some(item => item.id === media.id);
            const isInMangaList = mangaList.some(item => item.id === media.id);
            const isFavorite = favoritesList.some(item => item.id === media.id);
            
            // Determine which list buttons to show
            const animeFormats = ['TV', 'TV_SHORT', 'MOVIE', 'SPECIAL', 'OVA', 'ONA'];
            const mangaFormats = ['MANGA', 'NOVEL', 'ONE_SHOT'];
            
            const showAnimeButton = animeFormats.includes(media.format);
            const showMangaButton = mangaFormats.includes(media.format);
            
            const animeListButtonText = isInAnimeList ? 'Remove from Anime List' : 'Add to Anime List';
            const animeListButtonClass = isInAnimeList ? 'secondary' : '';
            
            const mangaListButtonText = isInMangaList ? 'Remove from Manga List' : 'Add to Manga List';
            const mangaListButtonClass = isInMangaList ? 'secondary' : '';
            
            const favoriteButtonText = isFavorite ? 'Remove from Favorites' : 'Add to Favorites';
            const favoriteButtonClass = isFavorite ? 'favorite active' : 'favorite';
            
            modalBody.innerHTML = `
                <div class="modal-header">
                    <img src="${media.bannerImage || media.coverImage.extraLarge || media.coverImage.large}" alt="${title}" class="modal-banner">
                    <div class="modal-overlay"></div>
                    <div class="modal-content-inner">
                        <div class="modal-image">
                            <img src="${media.coverImage.extraLarge || media.coverImage.large}" alt="${title}" loading="lazy">
                        </div>
                        <div class="modal-info">
                            <h1 class="modal-title">${title}</h1>
                            ${nativeTitle ? `<h2 class="modal-native-title">${nativeTitle}</h2>` : ''}
                            <div class="modal-details">
                                <div class="modal-detail">${media.format || 'N/A'}</div>
                                <div class="modal-detail">${media.status || 'Unknown'}</div>
                                <div class="modal-detail">${startDate} - ${endDate}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-info-circle"></i> Overview</h3>
                    <p class="modal-description">${description}</p>
                </div>
                <div class="modal-section">
                    <div class="modal-stats">
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${score}/10</div>
                            <div class="stat-label-modal">Average Score</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${meanScore}/10</div>
                            <div class="stat-label-modal">Mean Score</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${media.popularity?.toLocaleString() || 'N/A'}</div>
                            <div class="stat-label-modal">Popularity</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${media.favourites?.toLocaleString() || 'N/A'}</div>
                            <div class="stat-label-modal">Favorites</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-tags"></i> Genres</h3>
                    <div class="genres-list">
                        ${genres.split(', ').map(genre => `
                            <div class="genre-tag-modal">${genre}</div>
                        `).join('')}
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-list"></i> Details</h3>
                    <div class="modal-details">
                        <div class="modal-detail">${media.episodes ? `${media.episodes} episodes` : ''}</div>
                        <div class="modal-detail">${media.chapters ? `${media.chapters} chapters` : ''}</div>
                        <div class="modal-detail">${media.volumes ? `${media.volumes} volumes` : ''}</div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-users"></i> Characters</h3>
                    <div class="cards-grid">
                        ${media.characters && media.characters.nodes ? 
                            media.characters.nodes.slice(0, 6).map(char => `
                                <div class="card">
                                    <img src="${char.image.medium}" alt="${char.name.full}" class="card-img">
                                    <div class="card-content">
                                        <h3 class="card-title">${char.name.full}</h3>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p>No characters available</p>'
                        }
                    </div>
                </div>
                <div class="favorite-actions">
                    <button class="action-btn ${favoriteButtonClass}" id="add-to-favorites">
                        <i class="fas fa-heart"></i> ${favoriteButtonText}
                    </button>
                    ${showAnimeButton ? `
                        <button class="action-btn ${animeListButtonClass}" id="add-to-anime-list">
                            <i class="fas fa-tv"></i> ${animeListButtonText}
                        </button>
                    ` : ''}
                    ${showMangaButton ? `
                        <button class="action-btn ${mangaListButtonClass}" id="add-to-manga-list">
                            <i class="fas fa-book"></i> ${mangaListButtonText}
                        </button>
                    ` : ''}
                </div>
            `;
            
            // Add event listeners to action buttons
            const animeListBtn = document.getElementById('add-to-anime-list');
            const mangaListBtn = document.getElementById('add-to-manga-list');
            const favoriteBtn = document.getElementById('add-to-favorites');
            
            if (animeListBtn) {
                animeListBtn.addEventListener('click', () => {
                    toggleAnimeList(media);
                });
            }
            
            if (mangaListBtn) {
                mangaListBtn.addEventListener('click', () => {
                    toggleMangaList(media);
                });
            }
            
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', () => {
                    toggleFavorite(media);
                });
            }
        }

        // Toggle anime list
        async function toggleAnimeList(media) {
            if (!currentUser) {
                showNotification('Please login to manage your anime list');
                return;
            }
            
            const existingIndex = animeList.findIndex(item => item.id === media.id);
            if (existingIndex > -1) {
                // Remove from anime list
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int) {
                                    DeleteMediaListEntry(mediaId: $mediaId, type: ANIME) {
                                        deleted
                                    }
                                }
                            `,
                            variables: {
                                mediaId: media.id
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error removing from anime list:', data.errors);
                        showNotification('Failed to remove from anime list');
                    } else {
                        animeList.splice(existingIndex, 1);
                        showNotification('Removed from anime list');
                    }
                } catch (error) {
                    console.error('Error removing from anime list:', error);
                    showNotification('Network error removing from anime list');
                }
            } else {
                // Add to anime list
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $status: MediaListStatus) {
                                    SaveMediaListEntry(mediaId: $mediaId, status: $status, type: ANIME) {
                                        id
                                        status
                                        progress
                                        score
                                    }
                                }
                            `,
                            variables: {
                                mediaId: media.id,
                                status: 'PLANNING'
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error adding to anime list:', data.errors);
                        showNotification('Failed to add to anime list');
                    } else {
                        const animeItem = {
                            id: media.id,
                            title: media.title.english || media.title.romaji || 'Untitled',
                            image: media.coverImage.large,
                            type: 'anime',
                            status: 'planning',
                            score: media.averageScore ? (media.averageScore / 10).toFixed(1) : 0,
                            progress: 0,
                            maxProgress: media.episodes || 0,
                            createdAt: new Date().toISOString()
                        };
                        animeList.push(animeItem);
                        showNotification('Added to anime list!');
                    }
                } catch (error) {
                    console.error('Error adding to anime list:', error);
                    showNotification('Network error adding to anime list');
                }
            }
            
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const animeListBtn = document.getElementById('add-to-anime-list');
                const isCurrentlyInAnimeList = animeList.some(item => item.id === media.id);
                if (isCurrentlyInAnimeList) {
                    animeListBtn.textContent = 'Remove from Anime List';
                    animeListBtn.className = 'action-btn secondary';
                } else {
                    animeListBtn.textContent = 'Add to Anime List';
                    animeListBtn.className = 'action-btn';
                }
            }
            
            // Update profile stats
            loadProfileStats();
        }

        // Toggle manga list
        async function toggleMangaList(media) {
            if (!currentUser) {
                showNotification('Please login to manage your manga list');
                return;
            }
            
            const existingIndex = mangaList.findIndex(item => item.id === media.id);
            if (existingIndex > -1) {
                // Remove from manga list
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int) {
                                    DeleteMediaListEntry(mediaId: $mediaId, type: MANGA) {
                                        deleted
                                    }
                                }
                            `,
                            variables: {
                                mediaId: media.id
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error removing from manga list:', data.errors);
                        showNotification('Failed to remove from manga list');
                    } else {
                        mangaList.splice(existingIndex, 1);
                        showNotification('Removed from manga list');
                    }
                } catch (error) {
                    console.error('Error removing from manga list:', error);
                    showNotification('Network error removing from manga list');
                }
            } else {
                // Add to manga list
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($mediaId: Int, $status: MediaListStatus) {
                                    SaveMediaListEntry(mediaId: $mediaId, status: $status, type: MANGA) {
                                        id
                                        status
                                        progress
                                        score
                                    }
                                }
                            `,
                            variables: {
                                mediaId: media.id,
                                status: 'PLANNING'
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error adding to manga list:', data.errors);
                        showNotification('Failed to add to manga list');
                    } else {
                        const mangaItem = {
                            id: media.id,
                            title: media.title.english || media.title.romaji || 'Untitled',
                            image: media.coverImage.large,
                            type: 'manga',
                            status: 'planning',
                            score: media.averageScore ? (media.averageScore / 10).toFixed(1) : 0,
                            progress: 0,
                            maxProgress: media.chapters || 0,
                            createdAt: new Date().toISOString()
                        };
                        mangaList.push(mangaItem);
                        showNotification('Added to manga list!');
                    }
                } catch (error) {
                    console.error('Error adding to manga list:', error);
                    showNotification('Network error adding to manga list');
                }
            }
            
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const mangaListBtn = document.getElementById('add-to-manga-list');
                const isCurrentlyInMangaList = mangaList.some(item => item.id === media.id);
                if (isCurrentlyInMangaList) {
                    mangaListBtn.textContent = 'Remove from Manga List';
                    mangaListBtn.className = 'action-btn secondary';
                } else {
                    mangaListBtn.textContent = 'Add to Manga List';
                    mangaListBtn.className = 'action-btn';
                }
            }
            
            // Update profile stats
            loadProfileStats();
        }

        // Toggle favorite
        async function toggleFavorite(media) {
            if (!currentUser) {
                showNotification('Please login to manage your favorites');
                return;
            }
            
            const existingIndex = favoritesList.findIndex(item => item.id === media.id);
            if (existingIndex > -1) {
                // Remove from favorites
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($animeId: Int, $mangaId: Int) {
                                    ToggleFavourite(animeId: $animeId, mangaId: $mangaId) {
                                        anime {
                                            nodes {
                                                id
                                            }
                                        }
                                        manga {
                                            nodes {
                                                id
                                            }
                                        }
                                    }
                                }
                            `,
                            variables: {
                                animeId: media.format !== 'MANGA' ? media.id : undefined,
                                mangaId: media.format === 'MANGA' ? media.id : undefined
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error removing from favorites:', data.errors);
                        showNotification('Failed to remove from favorites');
                    } else {
                        favoritesList.splice(existingIndex, 1);
                        showNotification('Removed from favorites');
                    }
                } catch (error) {
                    console.error('Error removing from favorites:', error);
                    showNotification('Network error removing from favorites');
                }
            } else {
                // Add to favorites
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('anilist_token')}`
                        },
                        body: JSON.stringify({
                            query: `
                                mutation ($animeId: Int, $mangaId: Int) {
                                    ToggleFavourite(animeId: $animeId, mangaId: $mangaId) {
                                        anime {
                                            nodes {
                                                id
                                            }
                                        }
                                        manga {
                                            nodes {
                                                id
                                            }
                                        }
                                    }
                                }
                            `,
                            variables: {
                                animeId: media.format !== 'MANGA' ? media.id : undefined,
                                mangaId: media.format === 'MANGA' ? media.id : undefined
                            }
                        })
                    });
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Error adding to favorites:', data.errors);
                        showNotification('Failed to add to favorites');
                    } else {
                        const favoriteItem = {
                            id: media.id,
                            title: media.title.english || media.title.romaji || 'Untitled',
                            image: media.coverImage.large,
                            type: media.format === 'MANGA' ? 'manga' : 'anime'
                        };
                        favoritesList.push(favoriteItem);
                        showNotification('Added to favorites!');
                    }
                } catch (error) {
                    console.error('Error adding to favorites:', error);
                    showNotification('Network error adding to favorites');
                }
            }
            
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const favoriteBtn = document.getElementById('add-to-favorites');
                const isCurrentlyFavorite = favoritesList.some(item => item.id === media.id);
                if (isCurrentlyFavorite) {
                    favoriteBtn.textContent = 'Remove from Favorites';
                    favoriteBtn.className = 'action-btn favorite active';
                } else {
                    favoriteBtn.textContent = 'Add to Favorites';
                    favoriteBtn.className = 'action-btn favorite';
                }
            }
            
            // Update favorites display
            loadFavoritesDisplay();
            loadProfileStats();
        }

        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Utility function to get current season
        function getCurrentSeason(month) {
            if (month >= 2 && month <= 4) return 'SPRING';
            if (month >= 5 && month <= 7) return 'SUMMER';
            if (month >= 8 && month <= 10) return 'FALL';
            return 'WINTER';
        }

        // Handle tab change for view all links
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-all')) {
                e.preventDefault();
                const tab = e.target.dataset.tab;
                if (tab) {
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    const tabLink = document.querySelector(`nav a[data-tab="${tab}"]`);
                    if (tabLink) {
                        tabLink.classList.add('active');
                        currentTab = tab;
                        currentPage = 1;
                        updateSidebarFilters();
                        loadContent();
                    }
                }
            }
        });

        // Load profile stats
        function loadProfileStats() {
            const animeCount = animeList.length;
            const mangaCount = mangaList.length;
            const favoritesCount = favoritesList.length;
            const watchlistCount = animeList.filter(item => item.status === 'planning').length + 
                                 mangaList.filter(item => item.status === 'planning').length;
            document.getElementById('profile-anime-count').textContent = animeCount;
            document.getElementById('profile-manga-count').textContent = mangaCount;
            document.getElementById('profile-favorites-count').textContent = favoritesCount;
            document.getElementById('profile-watchlist-count').textContent = watchlistCount;
        }

        // Check for OAuth callback when page loads
        window.addEventListener('load', () => {
            handleOAuthCallback();
        });
    </script>
</body>
</html>
